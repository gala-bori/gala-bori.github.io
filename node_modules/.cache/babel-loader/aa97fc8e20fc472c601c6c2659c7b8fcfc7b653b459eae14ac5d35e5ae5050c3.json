{"ast":null,"code":"import _slicedToArray from\"/home/user/Documents/gala-bori/Submission/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState}from'react';import{useNavigate}from'react-router-dom';import'bootstrap/dist/css/bootstrap.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var API_URL=\"http://sefdb02.qut.edu.au:3000\";function Login(_ref){var handleLogin=_ref.handleLogin;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var navigate=useNavigate();var handleSuccessfulLogin=function handleSuccessfulLogin(){alert(\"Welcome \".concat(email,\"!\"));handleLogin();// updates the isLoggedIn state in app.js\nvar currentPath=window.location.pathname;if(currentPath===\"/login\"){// Navigate to movies page IFF loggin in from login page otherwise login (success) > actor page\nnavigate(\"/movies\");}};var handleEmailChange=function handleEmailChange(x){//Functions to set data when requested by input forms below\nsetEmail(x.target.value);};var handlePasswordChange=function handlePasswordChange(x){setPassword(x.target.value);};var handleSubmit=function handleSubmit(x){//Function to POST email/password to API and handle return tokens/errors\nx.preventDefault();var url=\"\".concat(API_URL,\"/user/login\");fetch(url,{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({email:email,password:password})}).then(function(res){if(res.status===200){return res.json();}else if(res.status===400){throw new Error(\"Both email and password are required\");}else if(res.status===401){throw new Error(\"Incorrect email or password\");}else if(res.status===429){throw new Error(\"Too many requests, please try again later.\");}else{throw new Error(\"Login failed\");}}).then(function(data){var bearerToken=data.bearerToken.token;var refreshToken=data.refreshToken.token;localStorage.setItem(\"email\",email);localStorage.setItem(\"token\",bearerToken);localStorage.setItem(\"refreshToken\",refreshToken);handleSuccessfulLogin();//Calls above function and redirects to appropriate page\n}).catch(function(error){alert(error.message);console.log(error);//Display/log any errors\n});};return/*#__PURE__*/ (//Renders two input forms and submit button\n_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Login\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"register-form\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Email:\",/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:email,onChange:handleEmailChange,className:\"form-control custom-input\"})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Password:\",/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,onChange:handlePasswordChange,className:\"form-control custom-input\"})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary\",children:\"Login\"})]})]}));}export default Login;","map":{"version":3,"names":["useState","useNavigate","jsx","_jsx","jsxs","_jsxs","API_URL","Login","_ref","handleLogin","_useState","_useState2","_slicedToArray","email","setEmail","_useState3","_useState4","password","setPassword","navigate","handleSuccessfulLogin","alert","concat","currentPath","window","location","pathname","handleEmailChange","x","target","value","handlePasswordChange","handleSubmit","preventDefault","url","fetch","method","headers","body","JSON","stringify","then","res","status","json","Error","data","bearerToken","token","refreshToken","localStorage","setItem","catch","error","message","console","log","className","children","onSubmit","type","onChange"],"sources":["/home/user/Documents/gala-bori/Submission/src/authentification/Login.js"],"sourcesContent":["import { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport 'bootstrap/dist/css/bootstrap.css';\n\nconst API_URL = `http://sefdb02.qut.edu.au:3000`;\n\nfunction Login({ handleLogin }) {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const navigate = useNavigate();\n\n  const handleSuccessfulLogin = () => {\n    alert(`Welcome ${email}!`);\n    handleLogin(); // updates the isLoggedIn state in app.js\n    const currentPath = window.location.pathname;\n\n    if (currentPath === \"/login\") {// Navigate to movies page IFF loggin in from login page otherwise login (success) > actor page\n      navigate(\"/movies\");\n    }\n  };\n\n  const handleEmailChange = (x) => { //Functions to set data when requested by input forms below\n    setEmail(x.target.value);\n  };\n\n  const handlePasswordChange = (x) => {\n    setPassword(x.target.value);\n  };\n\n  const handleSubmit = (x) => { //Function to POST email/password to API and handle return tokens/errors\n    x.preventDefault();\n\n    const url = `${API_URL}/user/login`;\n\n    fetch(url, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({ email, password }),\n    })\n      .then((res) => {\n        if (res.status === 200) {\n          return res.json();\n        } else if (res.status === 400) {\n          throw new Error(\"Both email and password are required\");\n        } else if (res.status === 401) {\n          throw new Error(\"Incorrect email or password\");\n        } else if (res.status === 429) {\n          throw new Error(\"Too many requests, please try again later.\");\n        } else {\n          throw new Error(\"Login failed\");\n        }\n      })\n      .then((data) => {\n        const bearerToken = data.bearerToken.token; \n        const refreshToken = data.refreshToken.token; \n        localStorage.setItem(\"email\", email); \n        localStorage.setItem(\"token\", bearerToken); \n        localStorage.setItem(\"refreshToken\", refreshToken); \n\n        handleSuccessfulLogin(); //Calls above function and redirects to appropriate page\n\n      })\n      .catch((error) => {\n        alert(error.message);\n        console.log(error); //Display/log any errors\n      });\n  };\n\n  return ( //Renders two input forms and submit button\n    <div className=\"App\">\n      <h1>Login</h1>\n      <form onSubmit={handleSubmit} className=\"register-form\">\n        <label>\n          Email:\n          <input\n            type=\"email\"\n            value={email}\n            onChange={handleEmailChange}\n            className=\"form-control custom-input\"\n          />\n        </label>\n        <br />\n        <label>\n          Password:\n          <input\n            type=\"password\"\n            value={password}\n            onChange={handlePasswordChange}\n            className=\"form-control custom-input\"\n          />\n        </label>\n        <br />\n        <button type=\"submit\" className=\"btn btn-primary\">Login</button>\n      </form>\n    </div>\n  );\n}\n\nexport default Login;\n\n\n"],"mappings":"+HAAA,OAASA,QAAQ,KAAQ,OAAO,CAChC,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,MAAO,kCAAkC,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAE1C,GAAM,CAAAC,OAAO,iCAAmC,CAEhD,QAAS,CAAAC,KAAKA,CAAAC,IAAA,CAAkB,IAAf,CAAAC,WAAW,CAAAD,IAAA,CAAXC,WAAW,CAC1B,IAAAC,SAAA,CAA0BV,QAAQ,CAAC,EAAE,CAAC,CAAAW,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAA/BG,KAAK,CAAAF,UAAA,IAAEG,QAAQ,CAAAH,UAAA,IACtB,IAAAI,UAAA,CAAgCf,QAAQ,CAAC,EAAE,CAAC,CAAAgB,UAAA,CAAAJ,cAAA,CAAAG,UAAA,IAArCE,QAAQ,CAAAD,UAAA,IAAEE,WAAW,CAAAF,UAAA,IAC5B,GAAM,CAAAG,QAAQ,CAAGlB,WAAW,EAAE,CAE9B,GAAM,CAAAmB,qBAAqB,CAAG,QAAxB,CAAAA,qBAAqBA,CAAA,CAAS,CAClCC,KAAK,YAAAC,MAAA,CAAYT,KAAK,MAAI,CAC1BJ,WAAW,EAAE,CAAE;AACf,GAAM,CAAAc,WAAW,CAAGC,MAAM,CAACC,QAAQ,CAACC,QAAQ,CAE5C,GAAIH,WAAW,GAAK,QAAQ,CAAE,CAAC;AAC7BJ,QAAQ,CAAC,SAAS,CAAC,CACrB,CACF,CAAC,CAED,GAAM,CAAAQ,iBAAiB,CAAG,QAApB,CAAAA,iBAAiBA,CAAIC,CAAC,CAAK,CAAE;AACjCd,QAAQ,CAACc,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC,CAC1B,CAAC,CAED,GAAM,CAAAC,oBAAoB,CAAG,QAAvB,CAAAA,oBAAoBA,CAAIH,CAAC,CAAK,CAClCV,WAAW,CAACU,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC,CAC7B,CAAC,CAED,GAAM,CAAAE,YAAY,CAAG,QAAf,CAAAA,YAAYA,CAAIJ,CAAC,CAAK,CAAE;AAC5BA,CAAC,CAACK,cAAc,EAAE,CAElB,GAAM,CAAAC,GAAG,IAAAZ,MAAA,CAAMhB,OAAO,eAAa,CAEnC6B,KAAK,CAACD,GAAG,CAAE,CACTE,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAE3B,KAAK,CAALA,KAAK,CAAEI,QAAQ,CAARA,QAAS,CAAC,CAC1C,CAAC,CAAC,CACCwB,IAAI,CAAC,SAACC,GAAG,CAAK,CACb,GAAIA,GAAG,CAACC,MAAM,GAAK,GAAG,CAAE,CACtB,MAAO,CAAAD,GAAG,CAACE,IAAI,EAAE,CACnB,CAAC,IAAM,IAAIF,GAAG,CAACC,MAAM,GAAK,GAAG,CAAE,CAC7B,KAAM,IAAI,CAAAE,KAAK,CAAC,sCAAsC,CAAC,CACzD,CAAC,IAAM,IAAIH,GAAG,CAACC,MAAM,GAAK,GAAG,CAAE,CAC7B,KAAM,IAAI,CAAAE,KAAK,CAAC,6BAA6B,CAAC,CAChD,CAAC,IAAM,IAAIH,GAAG,CAACC,MAAM,GAAK,GAAG,CAAE,CAC7B,KAAM,IAAI,CAAAE,KAAK,CAAC,4CAA4C,CAAC,CAC/D,CAAC,IAAM,CACL,KAAM,IAAI,CAAAA,KAAK,CAAC,cAAc,CAAC,CACjC,CACF,CAAC,CAAC,CACDJ,IAAI,CAAC,SAACK,IAAI,CAAK,CACd,GAAM,CAAAC,WAAW,CAAGD,IAAI,CAACC,WAAW,CAACC,KAAK,CAC1C,GAAM,CAAAC,YAAY,CAAGH,IAAI,CAACG,YAAY,CAACD,KAAK,CAC5CE,YAAY,CAACC,OAAO,CAAC,OAAO,CAAEtC,KAAK,CAAC,CACpCqC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAEJ,WAAW,CAAC,CAC1CG,YAAY,CAACC,OAAO,CAAC,cAAc,CAAEF,YAAY,CAAC,CAElD7B,qBAAqB,EAAE,CAAE;AAE3B,CAAC,CAAC,CACDgC,KAAK,CAAC,SAACC,KAAK,CAAK,CAChBhC,KAAK,CAACgC,KAAK,CAACC,OAAO,CAAC,CACpBC,OAAO,CAACC,GAAG,CAACH,KAAK,CAAC,CAAE;AACtB,CAAC,CAAC,CACN,CAAC,CAED,oBAAS;AACPhD,KAAA,QAAKoD,SAAS,CAAC,KAAK,CAAAC,QAAA,eAClBvD,IAAA,OAAAuD,QAAA,CAAI,OAAK,EAAK,cACdrD,KAAA,SAAMsD,QAAQ,CAAE3B,YAAa,CAACyB,SAAS,CAAC,eAAe,CAAAC,QAAA,eACrDrD,KAAA,UAAAqD,QAAA,EAAO,QAEL,cAAAvD,IAAA,UACEyD,IAAI,CAAC,OAAO,CACZ9B,KAAK,CAAEjB,KAAM,CACbgD,QAAQ,CAAElC,iBAAkB,CAC5B8B,SAAS,CAAC,2BAA2B,EACrC,GACI,cACRtD,IAAA,SAAM,cACNE,KAAA,UAAAqD,QAAA,EAAO,WAEL,cAAAvD,IAAA,UACEyD,IAAI,CAAC,UAAU,CACf9B,KAAK,CAAEb,QAAS,CAChB4C,QAAQ,CAAE9B,oBAAqB,CAC/B0B,SAAS,CAAC,2BAA2B,EACrC,GACI,cACRtD,IAAA,SAAM,cACNA,IAAA,WAAQyD,IAAI,CAAC,QAAQ,CAACH,SAAS,CAAC,iBAAiB,CAAAC,QAAA,CAAC,OAAK,EAAS,GAC3D,GACH,EAEV,CAEA,cAAe,CAAAnD,KAAK"},"metadata":{},"sourceType":"module","externalDependencies":[]}